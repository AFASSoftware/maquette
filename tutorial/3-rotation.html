<!doctype html>
<html>
  <head>
    <title>Tutorial</title>
    <link href="tutorial.css" rel="stylesheet" />
    <script src="bower_components/maquette/dist/maquette.min.js"></script>
    <script src="bower_components/ace-builds/src-noconflict/ace.js"></script>
    <script src="components/markup-matcher.js"></script>
    <script src="components/workbench.js"></script>
    <script src="components/navigation.js"></script>
    <style>
      li.complete {
        background-color: green;
      }
    </style>
    <script>
      document.addEventListener('DOMContentLoaded', function () {

        var h = maquette.h;

        // Renders the virtual DOM
        var render = function () {
          return h("div.projector", [
            workbench.renderMaquette(),
            navigation.renderMaquette()
          ]);

        };

        // Starts the projector, which renders the virtual DOM at the right moments
        var projector = maquette.createProjector(document.querySelector(".projector"), render, {});

        var hasStyleAttribute = false;
        var usesRotation = false;
        var rotationOk = false;
        var objective = {
          title: "Render the DOM",
          isAchieved: function () {
            return hasStyleAttribute && usesRotation && rotationOk;
          },
          onSceneUpdate: function (contentWindow) {
            hasStyleAttribute = false;
            usesRotation = false;
            rotationOk = false;
            var oldRotation = contentWindow.rotation;
            try {
              var vnode = contentWindow.renderMaquette();
              var saucer = vnode.children[0].children[0];
              var style = saucer.properties.style;
              hasStyleAttribute = typeof style === "string";
              if (hasStyleAttribute) {
                rotationOk = style === "transform:rotate(45deg)";
                contentWindow.rotation = 615243;
                style = contentWindow.renderMaquette().children[0].children[0].properties.style;
                usesRotation = style.indexOf("615243") !== -1;
                contentWindow.rotation = oldRotation;
              }
            } catch(e) {
              contentWindow.rotation = oldRotation;
            }
          },
          renderMaquette: function () {
            return h("ul", [
              h("li", {key:1, classes: {complete:hasStyleAttribute} }, ["The saucer has a style attribute"]),
              h("li", {key:2, classes: {complete:usesRotation} }, ["The style attribute uses the rotation variable"]),
              h("li", { key: 3, classes: { complete: rotationOk } }, ["The style attribute equals 'transform:rotation(45deg)'"])
          ]);
          }
        };
        var workbench = createWorkbench(projector, "assets/saucer-rotation.js", [
          objective
        ]);
        var navigation = createNavigation(projector, "2-variables-and-properties.html", "9-to-be-continued.html", workbench.allObjectivesAchieved);
      });
    </script>
  </head>
<body>
  <div class="projector"></div>
</body>
</html>
